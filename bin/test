#!/usr/bin/env ruby
# Test runner for RHDL - works around bundler issues
# Usage: bin/test [rspec arguments]
#
# Examples:
#   bin/test                                    # Run all tests
#   bin/test spec/examples/mos6502/             # Run 6502 tests
#   bin/test spec/examples/mos6502/cpu_spec.rb  # Run specific file
#   bin/test --format documentation             # With formatting

require 'rubygems'

# Ensure rspec gems are available
begin
  gem 'rspec-core'
  gem 'rspec-expectations'
  gem 'rspec-mocks'
rescue Gem::LoadError => e
  puts "Missing gem: #{e.message}"
  puts "Install with: gem install rspec-core rspec-expectations rspec-mocks"
  exit 1
end

require 'rspec/core'
require 'rspec/expectations'
require 'rspec/mocks'

# Add lib to load path
$LOAD_PATH.unshift File.expand_path('../lib', __dir__)
require 'rhdl'

# Configure RSpec
RSpec.configure do |config|
  config.expect_with :rspec do |c|
    c.syntax = :expect
  end
end

# Run with provided arguments, defaulting to spec/ directory
args = ARGV.empty? ? ['spec/'] : ARGV
exit_code = RSpec::Core::Runner.run(args)
exit exit_code
